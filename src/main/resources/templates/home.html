<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Player Management</title>
    <link crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/bootstrap@4.3.1/dist/css/bootstrap.min.css"
          integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.3.0/font/bootstrap-icons.css" rel="stylesheet">
    <link rel="stylesheet" th:href="@{/css/style.css}">
    <link href="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/css/select2.min.css" rel="stylesheet"/>
    <link rel="stylesheet" th:href="@{/css/search.css}">
    <script crossorigin="anonymous"
            integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo"
            src="https://code.jquery.com/jquery-3.3.1.slim.min.js"></script>
    <script crossorigin="anonymous"
            integrity="sha384-UO2eT0CpHqdSJQ6hJty5KVphtPhzWj9WO1clHTMGa3JDZwrnQq4sF86dIHNDz0W1"
            src="https://cdn.jsdelivr.net/npm/popper.js@1.14.7/dist/umd/popper.min.js"></script>
    <script crossorigin="anonymous"
            integrity="sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM"
            src="https://cdn.jsdelivr.net/npm/bootstrap@4.3.1/dist/js/bootstrap.min.js"></script>
    <script th:src="@{/js/toastmessage.js}" type="text/javascript"></script>
    <script src="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/js/select2.min.js"></script>
</head>
<body>
<!--<h1 style="text-align: center; margin-bottom: 10px;">Đội hình của bạn</h1>-->
<div class="search">
    <form autocomplete="off"
          class="form-area" id="header-search-people" method="post" novalidate="novalidate"
          th:action="@{/player/search-player}"
          th:object="${searchPlayer}">
        <div class="row">
            <div class="col-md-1">
                <a href="/player/manage-player"><img src="/img/home.png"
                                                     style="width: 200%; height: 100%; margin-left: -94px;"></a>
            </div>
            <div class="col-md-9">
                <div class="styled-input wide multi">
                    <div class="first-name" id="input-first-name">
                        <input autocomplete="off" data-placeholder-focus="false" id="fn" name="fn" required
                               th:field="*{nameLike}" type="text"/>
                        <label>Tìm theo tên</label>
                        <svg class="icon--check" height="17px" version="1.1" viewBox="0 0 21 17" width="21px"
                             xmlns="http://www.w3.org/2000/svg">
                            <g fill="none" fill-rule="evenodd" id="Page-1" stroke="none" stroke-linecap="round"
                               stroke-width="1">
                                <g fill-rule="nonzero" id="UI-Elements-Forms"
                                   stroke="#81B44C" stroke-width="3" transform="translate(-255.000000, -746.000000)">
                                    <polyline id="Path-2"
                                              points="257 754.064225 263.505943 760.733489 273.634603 748"></polyline>
                                </g>
                            </g>
                        </svg>
                        <svg class="icon--error" height="15px" version="1.1" viewBox="0 0 15 15" width="15px"
                             xmlns="http://www.w3.org/2000/svg">
                            <g fill="none" fill-rule="evenodd" id="Page-1" stroke="none" stroke-linecap="round"
                               stroke-width="1">
                                <g fill-rule="nonzero" id="UI-Elements-Forms"
                                   stroke="#D0021B" stroke-width="3" transform="translate(-550.000000, -747.000000)">
                                    <g id="Group" transform="translate(552.000000, 749.000000)">
                                        <path d="M0,11.1298982 L11.1298982,-5.68434189e-14" id="Path-2-Copy"></path>
                                        <path d="M0,11.1298982 L11.1298982,-5.68434189e-14" id="Path-2-Copy-2"
                                              transform="translate(5.564949, 5.564949) scale(-1, 1) translate(-5.564949, -5.564949) "></path>
                                    </g>
                                </g>
                            </g>
                        </svg>
                    </div>
                    <div class="state">
                        <select class="selectpicker" data-live-search="true" name="state" placeholder="Quốc tịch"
                                th:field="*{countryId}">
                            <option th:value="null">Chọn quốc tịch</option>
                            <option th:each="c: ${countries}" th:text="${c.name}" th:value="${c.id}"></option>
                        </select>
                    </div>
                    <div class="state">
                        <select class="selectpicker" data-live-search="true" name="state" placeholder="Chọn vị trí"
                                th:field="*{positionDetailId}">
                            <option th:value="null">Chọn vị trí</option>
                            <option th:each="c: ${positionDetails}" th:text="${c.code}" th:value="${c.id}"></option>
                        </select>
                    </div>
                    <div class="state">
                        <select class="selectpicker" data-live-search="true" name="state"
                                placeholder="Tình trạng sức khỏe"
                                th:field="*{isInjury}">
                            <option th:value="null">Chọn tình trạng sức khỏe</option>
                            <option th:value="true">Chấn thương</option>
                            <option th:value="false">Lành lặn</option>
                        </select>
                    </div>
                    <div class="state">
                        <select class="selectpicker" data-live-search="true" name="state"
                                placeholder="Phong độ"
                                th:field="*{conditionId}">
                            <option th:value="null">Chọn phong độ</option>
                            <option th:each="c: ${conditions}" th:text="${c.name}"
                                    th:value="${c.id}">
                            </option>
                        </select>
                    </div>
                </div>
            </div>
            <div class="col-md-2 no-pad-left-10">
                <button class="primary-btn serach-btn" id="submit_btn" type="submit">Tìm kiếm</button>
            </div>
        </div>
    </form>
</div>
<!--form search-->
<div style="text-align: center; margin-bottom: 10px;">
    <a class="btn btn-success" href="/player/buy-player">Tuyển thêm cầu thủ</a>
    <button class="btn btn-primary" data-target="#exampleModal" data-toggle="modal" type="button">
        Xem ngân sách CLB hiện tại
    </button>
    <button class="btn btn-warning" data-target="#viewTransferHistory" data-toggle="modal" type="button">
        Xem lịch sử giao dịch của CLB
    </button>
    <form autocomplete="off"
          class="form-area" method="post" novalidate="novalidate"
          th:action="@{/player/to-excel}"
          th:object="${searchPlayer}">
        <button class="btn btn-danger" type="submit">Xuất dữ liệu ra excel</button>
    </form>
</div>
<div class="table1">
    <table cellpadding="0" cellspacing="10" class="table table-striped" th:if="${players.content.size() > 0}">
        <tr>
            <th>Id cầu thủ
                <div><a href="/player/manage-player?sortBy=id&&direction=ASC"><span
                        class="bi bi-arrow-up"
                        th:style="${cssArrow == 1 ? 'color: red' : 'color: #ccc'}"></span></a>
                    <a href="/player/manage-player?sortBy=id&&direction=DESC"><span
                            class="bi bi-arrow-down"
                            th:style="${cssArrow == 2 ? 'color: red' : 'color: #ccc'}"></span></a>
                </div>
            </th>
            <th>Tên cầu thủ</th>
            <th>Vị trí</th>
            <th>Vị trí chi tiết</th>
            <th>Lương</th>
            <th>Giá trị chuyển nhượng</th>
            <th>Quốc tịch</th>
            <th style="width: 120px">Ngày sinh</th>
            <th>Kỹ năng</th>
            <th>Số áo
                <div><a href="/player/manage-player?sortBy=clothesNumber&&direction=ASC"><span
                        class="bi bi-arrow-up"
                        th:style="${cssArrow == 3 ? 'color: red' : 'color: #ccc'}"></span></a>
                    <a href="/player/manage-player?sortBy=clothesNumber&&direction=DESC"><span
                            class="bi bi-arrow-down"
                            th:style="${cssArrow == 4 ? 'color: red' : 'color: #ccc'}"></span></a>
                </div>
            </th>
            <th>Tình trạng sức khỏe</th>
            <th>Thời gian gia nhập
                <div><a href="/player/manage-player?sortBy=createdAt&&direction=ASC"><span
                        class="bi bi-arrow-up"
                        th:style="${cssArrow == 5 ? 'color: red' : 'color: #ccc'}"></span></a>
                    <a href="/player/manage-player?sortBy=createdAt&&direction=DESC"><span
                            class="bi bi-arrow-down"
                            th:style="${cssArrow == 6 ? 'color: red' : 'color: #ccc'}"></span></a>
                </div>
            </th>
            <th>Avatar</th>
            <th>Phong độ</th>
            <th colspan="2">Hành động</th>
        </tr>
        <tr th:each="p : ${players}">
            <td th:text="${p.getId()}"></td>
            <td th:text="${p.getFullName()}"></td>
            <td th:text="${p.getPositionDescription()}"></td>
            <td th:text="${p.getPositionDetailCode()}"></td>
            <td onkeyup="format(this)" th:text="${p.getAnnuallySalary()}"></td>
            <td onkeyup="format(this)" th:text="${p.getMarketValue()}"></td>
            <td><img object-fit="contain" style="width: 50px; height: 50px;"
                     th:alt="${p.getCountryName()}"
                     th:src="@{https://flagcdn.com/{code}.svg(code=${p.getCountryCode()})}"></td>
            <td style="width: 120px" th:text="${#dates.format(p.getDateOfBirth(), 'dd-MM-yyyy')}"></td>
            <td th:text="${p.getSkill()}"></td>
            <td th:text="${p.getClothesNumber()}"></td>
            <td th:if="${p.getIsInjury()}"><img style="width: 30px; height: 30px;" th:src="@{/img/injury.png}"/></td>
            <td th:unless="${p.getIsInjury()}"><img style="width: 30px; height: 30px;" th:src="@{/img/strong.png}"/>
            </td>
            <td th:text="${#dates.format(p.getCreatedAt(), 'dd-MM-yyyy')}"></td>
            <td>
                <img alt="no image" style="width: 100px; height: 100px;" th:if="${p.getAvatar() != null}"
                     th:src="@{${p.getAvatar()}}">
                <img alt="no image" style="width: 100px; height: 100px;" th:src="@{/img/default.jpg}"
                     th:unless="${p.getAvatar() != null}">
            </td>
            <td><img object-fit="contain" style="width: 25px; height: 25px;" th:alt="${p.getConditionName()}"
                     th:src="@{${p.getConditionIcon()}}"></td>
            <td><a class="btn btn-danger" th:href="@{/player/detail-player(id=${p.getId()})}">Sa thải</a></td>
            <td><a class="btn btn-primary" th:href="@{/player/edit-player(id=${p.getId()})}">Cập nhật</a></td>
        </tr>
    </table>
</div>
<div class="alert alert-success" id="toast-message" role="alert" th:if="${toastMessage != null}">
    <button aria-label="Close" class="close" data-dismiss="alert" type="button"><span aria-hidden="true">&times;</span>
    </button>
    <strong>Thành công!</strong> <span th:remove="tag" th:text="${toastMessage}">title</span>
</div>
<!-- Modal -->
<div aria-hidden="true" aria-labelledby="exampleModalLabel" class="modal fade" id="exampleModal" role="dialog"
     tabindex="-1">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="exampleModalLabel" style="text-align: center; margin: 0 auto">Ngân sách
                    CLB</h5>
                <button aria-label="Close" class="close" data-dismiss="modal" type="button">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                <p style="font-weight: bold;">Quỹ lương hiện tại: <span
                        th:style="${budgetSalary.getValue() > 1000 ? 'color: darkgreen' : 'color: red'}"
                        th:text="${budgetSalary.getValue()}"></span></p>
                <p style="font-weight: bold;">Tổng tiền cho chuyển nhượng: <span
                        th:style="${budgetTotalMoney.getValue() > 1000 ? 'color: darkgreen' : 'color: red'}"
                        th:text="${budgetTotalMoney.getValue()}"></span></p>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" data-dismiss="modal" type="button">Trở về màn hình quản lý</button>
            </div>
        </div>
    </div>
</div>
<div aria-hidden="true" aria-labelledby="viewTransferHistoryLabel" class="modal fade" id="viewTransferHistory"
     role="dialog"
     tabindex="-1">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="viewTransferHistoryLabel" style="text-align: center; margin: 0 auto">Lịch sử
                    chuyển nhượng của CLB</h5>
                <button aria-label="Close" class="close" data-dismiss="modal" type="button">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                <p th:each="t:${transferHistories}"
                   th:text="${t.changeCategoryName + ' ' + t.objectName + ' với giá ' + t.marketValue + ' vào lúc ' + t.createdAt}"></p>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" data-dismiss="modal" type="button">Trở về màn hình quản lý</button>
            </div>
        </div>
    </div>
</div>
<div>
    <ul class="nav nav-pills">
        <li class="nav-item" th:each="i:${#numbers.sequence(0, players.totalPages - 1)}"
            th:if="${players.content.size()>0}">
            <a class="nav-link" th:href="@{'/player/manage-player?page=' + ${i} + ${pagingAndSortingParam}}"
               th:if="${pagingAndSortingParam != null}"
               th:text="${i+1}"></a>
            <a class="nav-link" th:href="@{'/player/manage-player?page=' + ${i}}"
               th:text="${i+1}"
               th:unless="${pagingAndSortingParam != null}"></a>
        </li>
    </ul>
</div>
<script>
    $(document).ready(function () {
        $('.selectpicker').select2();
    });
</script>
</body>
</html>